{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SecuRizon Event Schemas",
  "description": "JSON schemas for SecuRizon security events",
  "definitions": {
    "BaseEvent": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique event identifier"
        },
        "type": {
          "type": "string",
          "enum": [
            "asset.created",
            "asset.updated", 
            "asset.deleted",
            "relationship.created",
            "relationship.updated",
            "relationship.deleted",
            "finding.created",
            "finding.updated",
            "finding.resolved",
            "policy.violation",
            "threat.detected",
            "risk.score_changed"
          ]
        },
        "severity": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "provider": {
          "type": "string",
          "enum": ["aws", "azure", "gcp", "github", "jira"]
        },
        "environment": {
          "type": "string",
          "enum": ["prod", "staging", "dev", "test"]
        },
        "source": {
          "type": "string",
          "description": "Source system or service"
        },
        "actor": {
          "type": "string",
          "description": "Who performed the action"
        },
        "asset_id": {
          "type": "string",
          "description": "Associated asset ID"
        },
        "description": {
          "type": "string",
          "description": "Event description"
        },
        "metadata": {
          "type": "object",
          "description": "Additional event metadata"
        },
        "raw_data": {
          "type": "string",
          "contentEncoding": "base64",
          "description": "Original event data encoded in base64"
        }
      },
      "required": ["id", "type", "severity", "timestamp", "provider", "environment", "source", "description"]
    },
    "AssetEvent": {
      "allOf": [
        { "$ref": "#/definitions/BaseEvent" },
        {
          "type": "object",
          "properties": {
            "asset": {
              "$ref": "#/definitions/Asset"
            },
            "old_asset": {
              "$ref": "#/definitions/Asset"
            },
            "changes": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/FieldChange"
              }
            }
          },
          "required": ["asset"]
        }
      ]
    },
    "RelationshipEvent": {
      "allOf": [
        { "$ref": "#/definitions/BaseEvent" },
        {
          "type": "object",
          "properties": {
            "relationship": {
              "$ref": "#/definitions/Relationship"
            },
            "old_relationship": {
              "$ref": "#/definitions/Relationship"
            },
            "from_asset": {
              "$ref": "#/definitions/Asset"
            },
            "to_asset": {
              "$ref": "#/definitions/Asset"
            }
          },
          "required": ["relationship", "from_asset", "to_asset"]
        }
      ]
    },
    "FindingEvent": {
      "allOf": [
        { "$ref": "#/definitions/BaseEvent" },
        {
          "type": "object",
          "properties": {
            "finding": {
              "$ref": "#/definitions/Finding"
            },
            "old_finding": {
              "$ref": "#/definitions/Finding"
            },
            "asset": {
              "$ref": "#/definitions/Asset"
            }
          },
          "required": ["finding", "asset"]
        }
      ]
    },
    "PolicyViolationEvent": {
      "allOf": [
        { "$ref": "#/definitions/BaseEvent" },
        {
          "type": "object",
          "properties": {
            "policy_id": {
              "type": "string"
            },
            "policy_name": {
              "type": "string"
            },
            "policy_category": {
              "type": "string"
            },
            "severity": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "asset": {
              "$ref": "#/definitions/Asset"
            },
            "violation_details": {
              "type": "object"
            },
            "remediation": {
              "type": "string"
            }
          },
          "required": ["policy_id", "policy_name", "severity", "asset"]
        }
      ]
    },
    "ThreatEvent": {
      "allOf": [
        { "$ref": "#/definitions/BaseEvent" },
        {
          "type": "object",
          "properties": {
            "threat_type": {
              "type": "string"
            },
            "threat_id": {
              "type": "string"
            },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "indicators": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/ThreatIndicator"
              }
            },
            "affected_assets": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Asset"
              }
            },
            "mitre_ttp": {
              "type": "string"
            }
          },
          "required": ["threat_type", "threat_id", "confidence", "indicators"]
        }
      ]
    },
    "Asset": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "provider": {
          "type": "string",
          "enum": ["aws", "azure", "gcp", "github", "jira"]
        },
        "type": {
          "type": "string",
          "enum": ["identity", "compute", "network", "data", "saas"]
        },
        "environment": {
          "type": "string",
          "enum": ["prod", "staging", "dev", "test"]
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "first_seen": {
          "type": "string",
          "format": "date-time"
        },
        "last_seen": {
          "type": "string",
          "format": "date-time"
        },
        "tags": {
          "type": "object",
          "patternProperties": {
            ".*": {
              "type": "string"
            }
          }
        },
        "metadata": {
          "type": "object"
        }
      },
      "required": ["id", "provider", "type", "environment", "name", "created_at", "updated_at", "first_seen", "last_seen"]
    },
    "Relationship": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "from_asset_id": {
          "type": "string"
        },
        "to_asset_id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "ASSUMES_ROLE",
            "HAS_ACCESS_TO",
            "CONNECTED_TO",
            "RUNS_ON",
            "STORES",
            "GENERATES",
            "CONTAINS",
            "DEPENDS_ON",
            "MANAGES",
            "OWNS"
          ]
        },
        "properties": {
          "type": "object"
        },
        "valid_from": {
          "type": "string",
          "format": "date-time"
        },
        "valid_to": {
          "type": "string",
          "format": "date-time"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "strength": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "description": {
          "type": "string"
        }
      },
      "required": ["id", "from_asset_id", "to_asset_id", "type", "valid_from", "created_at", "updated_at", "strength"]
    },
    "Finding": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "policy_id": {
          "type": "string"
        },
        "severity": {
          "type": "number",
          "minimum": 0,
          "maximum": 10
        },
        "risk_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "status": {
          "type": "string",
          "enum": ["open", "resolved", "suppressed"]
        },
        "first_seen": {
          "type": "string",
          "format": "date-time"
        },
        "last_seen": {
          "type": "string",
          "format": "date-time"
        },
        "description": {
          "type": "string"
        },
        "recommendation": {
          "type": "string"
        },
        "asset_id": {
          "type": "string"
        },
        "false_positive": {
          "type": "boolean"
        },
        "suppressed": {
          "type": "boolean"
        },
        "suppressed_reason": {
          "type": "string"
        }
      },
      "required": ["id", "policy_id", "severity", "risk_score", "status", "first_seen", "last_seen", "description", "asset_id"]
    },
    "ThreatIndicator": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string"
        },
        "value": {
          "type": "string"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "source": {
          "type": "string"
        },
        "first_seen": {
          "type": "string",
          "format": "date-time"
        },
        "last_seen": {
          "type": "string",
          "format": "date-time"
        },
        "metadata": {
          "type": "object"
        }
      },
      "required": ["type", "value", "confidence", "source", "first_seen", "last_seen"]
    },
    "FieldChange": {
      "type": "object",
      "properties": {
        "field": {
          "type": "string"
        },
        "old_value": {},
        "new_value": {}
      },
      "required": ["field", "old_value", "new_value"]
    }
  }
}
